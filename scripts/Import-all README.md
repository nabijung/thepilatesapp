# Prospire MongoDB to Supabase Migration Tools

This repository contains tools to migrate data from MongoDB exports to Supabase for the Prospire Pilates application.

## Prerequisites

Before using these scripts, make sure you have:

- Node.js (v14 or newer)
- Supabase project set up with the correct schema
- Environment variables set up in a `.env.local` file

## Environment Setup

Create a `.env.local` file in the project root with the following variables:

```
SUPABASE_URL=https://your-project-id.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
```

## Installation

1. Install the required dependencies:

```bash
npm install @supabase/supabase-js bcryptjs dotenv fs path winston crypto
```

## Available Scripts

### 1. Import MongoDB Data

This script imports data from a MongoDB export file into Supabase.

```bash
npm run import:all <path_to_json_file>
```

```bash
npm run import:all ./database.json
```

The script will:

- Import studios, instructors, students, and their relationships
- Import exercise lists and individual exercises
- Import lessons
- Create notebooks for each student-studio relationship
- Set temporary passwords for all users (they'll need to set a new password on first login)
- **Save the IDs of all imported entities to `id-mappings.json`**

## ⚠️ IMPORTANT: ID Mappings File

**The `id-mappings.json` file is CRITICAL for the image import process to work correctly.**

- **Location**: Must be in the `scripts/` folder
- **Generated by**: The `import-all.js` script automatically creates this file
- **Required by**: The `import-images.js` script depends on this file to map old IDs to new IDs
- **Do NOT delete**: This file contains the mapping between original MongoDB IDs and new Supabase UUIDs

### File Structure
```
scripts/
├── import-all.js
├── import-images.js
├── id-mappings.json  ← CRITICAL: Must exist here
└── import_all/
    └── sample_db.json
```

### What happens if id-mappings.json is missing?
- The image import script will fail to map student IDs
- Profile images and progress photos will not be linked to the correct students
- You'll need to re-run the `import-all.js` script to regenerate the mappings